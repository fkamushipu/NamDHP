<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Digital Health Passport">	
        <meta name="keywords" content="health, COVID-19, vaccine, vaccination, test">
        <meta name="author" content="Feni Kamushipu">
        <title>Nam DHP</title>
        <link rel="icon" href="../images/DHP Done.png" type="image/x-icon">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="../style/style.css">
        <link rel="stylesheet" href="../style/profile.css">
        <link rel="stylesheet" href="../style/register.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        
    
    </head>
    <body>
      <div class="container">
        <div class="main-body">
          
          <div class="container-fluid">
            <div class="row content">
              <div class="col-sm-9">
                <div class="card mb-3">
                  <h6 class="heading1">Add User Vaccination details</h6>
                  <div class="card-body">
                    <div class="form-group row">
                      <label for="vaccinated" class="col-md-4 col-form-label text-md-right">Username:</label>
                      <select class="col-md-6 form-control" id="username">
                          <optgroup>
                              <option selected="selected" >Select Patient</option>
                             <!--  <option value="false" >No</option> -->
  
                          </optgroup>
                      
                      </select>
                  </div>
                   <!--  <div class="form-group row">
                      <label for="username" class="col-md-4 col-form-label text-md-right"> Patient Username</label>
                      <div class="col-md-6">
                          <input type="text" id="username" class="form-control" name="username" placeholder="Enter  patient's username" />
                      </div>
                  </div> -->
                  <div class="form-group row">
                    <label for="name" class="col-md-4 col-form-label text-md-right"> Patient First name</label>
                    <div class="col-md-6">
                        <input type="text" id="name" class="form-control" name="name" placeholder="Enter patient'First name" readonly />
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="last_name" class="col-md-4 col-form-label text-md-right"> Patient name</label>
                    <div class="col-md-6">
                        <input type="text" id="last_name" class="form-control" name="last_name" placeholder="Enter patient's last name" readonly/>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="vaccinated" class="col-md-4 col-form-label text-md-right">Is the patient vaccinated ?</label>
                    <select class="col-md-6 form-control" id="vaccinated">
                        <optgroup>
                            <option value="true" >Yes</option>
                            <option value="false" >No</option>

                        </optgroup>
                    
                    </select>
                </div>
                  <div class="form-group row">
                    <label for="vaccine_type" class="col-md-4 col-form-label text-md-right">COVID-19 Vaccine Type</label>
                    <select class="col-md-6 form-control" id="vaccine_type" >
                        <optgroup>

                    
                        <option selected="selected">Select Vaccine Type</option>
                        <option value="Sinopharm">Sinopharm</option>
                        <option value="AstraZeneca">Oxford-AstraZeneca, Sputnik V (Gamaleya Research Institute)</option>
                        <option value="Novavax">Novavax</option>
                        <option value="Moderna">Pfizer-BioNTech, Moderna</option>
                        <option value="other">Other</option>
                    </optgroup>
                    </select>
                </div>
                  <div class="form-group row">
                    <button class="btn btn-success btn-lg btn-block" onclick="update_user_btn()" type="submit"  id="update_user">Update Patient data</button>
                    
                </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
        <!-- Load React. -->
  <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha512-bnIvzh6FU75ZKxp0GXLH9bewza/OIw6dLVh9ICg0gogclmYGguQJWl8U30WpbsGTqbIiAwxTsbe76DErLq5EDQ==" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script> 
  <!-- Load our React component. -->
  <script src="app.js"></script>

  <script type="text/javascript">
 
  window.onload = function(){
     
        load_user_patient('Patient')
     }

    function logout(){
      sessionStorage.clear()
     window.location = "../register.html";
    }
    var user_details = null;
    function load_user_patient(id){
    var user_list='';
    $.getJSON("http://localhost:6503/api/users", function(data){
      user_list += '<option value=""> Select '+id+' </option>';
        data.reverse();
            $.each(data, function(key,value){
                if(id != ''){
                  user_list += '<option value="'+value.id+'">'+value.id+ " " +value.username+'</option>';
                }
                else{
                    
                }
            });
            $('#username').html(user_list);
            
        
            
    });
    
        };

        $("#username").change(function(){
         var user_id = $("#username").val();

        
         $.ajax({
                url:"http://localhost:6503/api/users/"+user_id,
                method: 'GET',
                dataType: 'json',
               
               // data: user,
                success:function(data){
                    console.log(data)
                    $('#id').val(data.id);         
                     $('#name').val(data.name);
                    $('#last_name').val(data.last_name);
                    $('#vaccinated').val(data.vaccinated);
        
                    if (data.vaccination_type == null) {
                      $('#vaccine_type').val("<option>Not Vaccinated</option>");
                    }else{
                      $('#vaccine_type').val(data.vaccination_type);
                    }
                    user_details = data;
                 
            },
            error: function(err){
            console.log(err);
              }
           });

        })
    function update_user_btn(){
                 user_details.vaccinated= $('#vaccinated').val();
                 user_details.vaccination_type = $('#vaccine_type').val();
                 console.log(user_details);

            $.ajax({
                url:"http://localhost:6503/api/users/"+user_details.id,
                method: 'PUT',
                dataType: 'json',
               
                data: user_details,
                success:function(data){
                    console.log(data)
                    Swal.fire({
                    title: 'User Vacccine Status Successfully Updated!',
                    type: 'success'
                });
            },
            error: function(err){
            console.log(err);
              }
           });
        }; 
    
  </script> 


    </body>
</html>
