<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Digital Health Passport">	

        <!--Search keywords-->
        <meta name="keywords" content="health, COVID-19, vaccine, vaccination, test">
        <meta name="author" content="Feni Kamushipu">

        <!--Page title -->
        <title>Nam DHP</title>

        <!--Icon for the website tab-->
        <link rel="icon" href="../images/DHP Done.png" type="image/x-icon">

        <!--Bootstrap Styling-->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        
        <!--The styling-->
        <link rel="stylesheet" href="../style/style.css">
        <link rel="stylesheet" href="../style/profile.css">
        <link rel="stylesheet" href="../style/register.css">

        <!--Ajax script link-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <!--Bootstrap Styling link-->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        
    
    </head>
    <body>
      <div class="container">
        <div class="main-body">

          <!--Top Navigation-->
          <nav class= "navbar  navbar-default ">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#topNavigation">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                  <a class="navbar-left" href="#"><img src="../images/Nam-DHP3.png"></a>
                </div>
                <div class="collapse  navbar-collapse" id="topNavigation">
                    <ul class="nav navbar-nav">
                        <li class="breadcrumb-item"><a href="profile.html">User Profile </a></li>
                        <li class="breadcrumb-item active"><a href="update.html">Update Profile </a></li>
                        <li class="breadcrumb-item"><a onclick="document.getElementById('booking').style.display='block'">Booking</a></li>
                        <li class="breadcrumb-item"><a onclick="document.getElementById('img').style.display='block'">Get QR code</a></li>
                      </ul>
                    <ul class="nav navbar-nav navbar-right">
                      <li><a onclick="logout()"><span class="glyphicon glyphicon-log-in"></span> Logout</a></li>
                    </ul>
                </div>
            </div>
          </nav>
          <div class="container-fluid">
            <div class="row content">
              <!--Side content box with profile-->
              <div class="col-sm-4">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex flex-column align-items-center text-center">
                      <img src="../images/profile avatar.jpg" alt="Admin" class="rounded-circle" width="150">
                      <div class="mt-3">
                        <h4><span id="profile-name"></span> <span id="profile-last-name"></span></h4>
                        <p class="text-secondary mb-1">Vaccinated: <span id="profile-vaccinated"></span></p>
                        <button class="btn btn-warning btn-block" onclick="logout()">Logout</button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card mt-3">
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                      <br><span class="text-secondary text-center">To make an appointment click the button below </span> <br><hr>
                      <button class="btn btn-primary btn-block" id="send" onclick="document.getElementById('booking').style.display='block'">Send An Appointment</button>
                    <div class="booking-modal" id="booking">
                      <div class="booking" >
                        <span onclick="document.getElementById('booking').style.display='none'" class="close">&times;</span>
                        <div class="card-header heading1 text-center"> Booking</div>
                        <div class="card-body">
                            <div class="form-group row">
                                <label for="appointment_reason" class="col-md-4 col-form-label text-md-right">Enter Your Reason For Booking"</label>
                                <textarea class="col-md-6" name="appointment_reason" id="appointment_reason" placeholder="Enter Your Reason For Booking" cols="30" rows="5"></textarea>
                                
                            </div>
        
                            <div class="col-md-6 offset-md-4">
                                <input type="submit" class="btn btn-primary btn-block " value="Send"  id="sent_appointment">
                            </div>
                        </div>
                      </div>
                    </div>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="col-sm-8">
                <h1 class="heading1 text-center">Update Profile</h1>
                <div class="card-body">

                    <div class="form-group row">
                        <label for="username" class="col-md-4 col-form-label text-md-right">Username</label>
                        <div class="col-md-6">
                            <input type="text" id="username" class="form-control" name="username" placeholder="Enter your username" required/>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="cellphone" class="col-md-4 col-form-label text-md-right">Phone Number</label>
                        <div class="col-md-6">
                            <input type="number" id="cellphone" class="form-control" placeholder="Enter phone number" name="cellphone" required >
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="email" class="col-md-4 col-form-label text-md-right">E-Mail Address</label>
                        <div class="col-md-6">
                            <input type="email" id="email" class="form-control" name="email" placeholder="Enter email address" />
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="pregnancy_status" class="col-md-4 col-form-label text-md-right">Are You Pregnant?</label>
                        <select class="col-md-6 " id="pregnancy_status">
                            <optgroup>
                                
                                <option value="false" >No</option>
                                <option value="true" >Yes</option>

                            </optgroup>
                        
                        </select>
                    </div>

                    <div class="form-group row">
                        <label for="lactating_status" class="col-md-4 col-form-label text-md-right">Are you breast feeding ?</label>
                        <select class="col-md-6 form-control" id="lactating_status" >
                            <optgroup>
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                            </optgroup>
                            
                        </select>
                    </div>

                    <div class="form-group row">
                        <label for="marital_status" class="col-md-4 col-form-label text-md-right">Marital Status</label>
                        <select class="col-md-6 form-control" id="marital_status">
                            <optgroup>

                        
                            <option selected="selected">Select Marital status</option>
                            <option value="single">Single</option>
                            <option value="married">Married</option>
                            <option value="divorced">Divorced</option>
                            <option value="widow">Widowed</option>
                            <option value="other">Other</option>
                        </optgroup>
                        </select>
                    </div>

                    <div class="form-group row">
                        <label for="guardian_name" class="col-md-4 col-form-label text-md-right">Name</label>
                        <div class="col-md-6">
                            <input type="text" id="guardian_name" class="form-control" name="guardian_name" placeholder="Enter your guardian's name or next of keen " />
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="guardian_contact" class="col-md-4 col-form-label text-md-right">Guardian Contact</label>
                        <div class="col-md-6">
                            <input type="text" id="guardian_contact" class="form-control" name="guardian_contact" placeholder="Enter your guardian's contact number">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="known_allergies" class="col-md-4 col-form-label text-md-right">Known Allergies </label>
                        <div class="col-md-6">
                            <input type="text" id="known_allergies" class="form-control" name="known_allergies" placeholder="Enter known allergies " />
                        </div>
                    </div>

                    <div class="form-group row">
                        <input class="btn btn-success btn-lg btn-block" type="submit" value="Update Profile"  id="update_user">
                    </div>

                </div>
                </div>
            </div>
          </div>
        </div>
    </div>
  <!-- Load React. -->
  <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha512-bnIvzh6FU75ZKxp0GXLH9bewza/OIw6dLVh9ICg0gogclmYGguQJWl8U30WpbsGTqbIiAwxTsbe76DErLq5EDQ==" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script> 
  <!-- Load our React component. -->
  <script src="vaccine.js"></script>

  <script type="text/javascript">
    var user = null;
    window.onload = function(){
      user = JSON.parse(sessionStorage.user_details)
      console.log(user)
      $('#profile-last-name').html(user.last_name)
      $('#profile-name').html(user.name)
      $('#profile-vaccinated').html(user.vaccination_status)

    }
    //function to update users profile

    $('#update_user').click(function(){
        var isValid = true;

        //Check if input text fields are empty
        $('input[type="text"]').each(function() {
          if ($.trim($(this).val()) == '') {
              isValid = false;
              $(this).css({
                  "border": "1px solid red",
                  "background": "#FFCECE"
              });
              Swal.fire({
              title : "Please fill in text information",
              type: 'warning',
              showConfirmButton: true,
              timer: 8000
              })
          }
          else {
              $(this).css({
                  "border": "",
                  "background": ""
              });
          }
      });
      
        //Check if input number fields are empty
        $('input[type="number"]').each(function() {
          if ($.trim($(this).val()) == '') {
              isValid = false;
              $(this).css({
                  "border": "1px solid red",
                  "background": "#FFCECE"
              });
              Swal.fire({
              title : "Please fill in numbers",
              type: 'warning',
              showConfirmButton: true,
              timer: 8000
              })
          }
          else {
              $(this).css({
                  "border": "",
                  "background": ""
              });
          }
      });
      
        //Check if input email fields are empty
        $('input[type="email"]').each(function() {
            if ($.trim($(this).val()) == '') {
                isValid = false;
                $(this).css({
                    "border": "1px solid red",
                    "background": "#FFCECE"
                });
                Swal.fire({
                title : "Please enter an email address",
                type: 'warning',
                showConfirmButton: true,
                timer: 8000
                })
            }
            else {
                $(this).css({
                    "border": "",
                    "background": ""
                });
            }
        });
        
                  
        if(isValid == true)
        {
        $.ajax({
          url:"http://localhost:6503/api/users/"+user.id,
          method: 'PUT',
          dataType: 'json',
            
          data: user,
          success:function(user_details){
            console.log(user_details);

            //Success Alert
            Swal.fire({
              title: 'User Profile Successfully Updated!',
              type: 'success',
              showConfirmButton: true,
              timer: 8000
            });
          },
          error: function(err){
            Swal.fire({
              title : "Please fill in all the informations",
              type: 'warning',
              showConfirmButton: true,
              timer: 8000
            })
            console.log(err);
          }
        });
        }
      });

        
    //Sending an appointment
      $("#sent_appointment").click(function(){    
        var appointment = new Object();
        appointment.user_id = user.id;
        appointment.reason = $("#appointment_reason").val();
        appointment.email = user.email;

        var isValid = true;
        //Check if input text fields are empty
        
        $('textarea').each(function() {
            if ($.trim($(this).val()) == '') {
                isValid = false;
                $(this).css({
                    "border": "1px solid red",
                    "background": "#FFCECE"
                });
                Swal.fire({
                title : "Appointment reason is empty",
                type: 'warning',
                showConfirmButton: true,
                timer: 8000
                })
            }
            else {
                $(this).css({
                    "border": "",
                    "background": ""
                });
            }
        });
        if (isValid==true){   

          $.ajax({
            url: "http://localhost:6503/api/appointments",
            method: 'POST',
            dataType: 'json',
            data: appointment,
            success: function(data){
              console.log(data)
              swal.fire({
                type: 'success',
                title: "Booking Successfully send",
                showConfirmButton: true,
                timer: 8000
              })
              window.location = "profile.html"  ;
            },
            error: function (request, status, error) {
              console.log(request.responseText);
              console.log("there is a problem");
            }
          })
        }
      })

    //Logout Function
    function logout(){
      swal.fire({
        type: 'warning',
        title: "Log Out",
        text: "Are you sure?",
        showConfirmButton: 'Yes',
        showCancelButton:'No',
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        closeOnConfirm:true,
        closeOnCancel:true,

        }).then((result) => { 
          if (result.value===true) { 
            swal.fire({
            type: 'warning',
            title: "Account Logging out " ,
            showConfirmButton: true,
            timer: 7500
          })
            sessionStorage.clear()
            window.location = "../index.html";
          }
        })
      }
    
    </script> 
  </body>
</html>
